<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="google-adsense-account" content="ca-pub-5978349780180432">
  <title>Plate Lookup &amp; Availability Tracking Eligibility System</title>
  <meta name="description" content="Dashboard to track vanity license plate availability across states.">
  <meta name="keywords" content="vanity plate check, personalized license plate, dmv plate lookup, custom license plates, license plate availability, california vanity plate, idaho vanity plate" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
  <link rel="preconnect" href="https://googleads.g.doubleclick.net" crossorigin>
  
  <!-- Schema.org JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "PLATES",
    "alternateName": "Plate Lookup & Availability Tracking Eligibility System",
    "url": "https://www.carsandcollectibles.com/vanity-monitor/",
    "description": "Free tool to check and track vanity license plate availability for California and Idaho.",
    "applicationCategory": "UtilityApplication",
    "operatingSystem": "Web"
  }
  </script>
  <style>
    /* Themes */
    :root {
      /* Default (Light) */
      --bg: #f8fafc;
      --surface: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --text-muted: #64748b;
      --accent: #10b981; /* Emerald 500 */
      --accent-hover: #059669;

      /* Light Plate Defaults */
      --plate-bg: radial-gradient(120% 120% at 50% -20%, #ffffff 0%, #f1f5f9 55%, #cbd5e1 100%);
      --plate-border: #94a3b8;
      --plate-text: #0f172a;
      --plate-shadow: inset 0 1px 0 rgba(255,255,255,1), inset 0 -2px 6px rgba(0,0,0,.1), 0 0 0 3px rgba(16,185,129,.25), 0 12px 36px rgba(16,185,129,.35);
      
      --st-avail-bg: #ecfdf5; --st-avail-brd: #6ee7b7; --st-avail-txt: #065f46;
      --st-unavail-bg: #fef2f2; --st-unavail-brd: #fca5a5; --st-unavail-txt: #991b1b;
      --st-error-bg: #fffbeb; --st-error-brd: #fcd34d; --st-error-txt: #92400e;
      --zoom: 1;
    }
    [data-theme="dark"] {
      --bg: #0f172a;
      --surface: #1e293b;
      --border: #334155;
      --text: #f8fafc;
      --text-muted: #94a3b8;
      --accent: #34d399; /* Emerald 400 */

      /* Dark Plate Override */
      --plate-bg: radial-gradient(120% 120% at 50% -20%, #1a1b21 0%, #0b0c10 55%, #000 100%);
      --plate-border: #2a2d3a;
      --plate-text: #fff;
      --plate-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -2px 6px rgba(0,0,0,.5), 0 0 0 3px rgba(59,130,246,.25), 0 12px 36px rgba(59,130,246,.35);
      
      --st-avail-bg: #064e3b; --st-avail-brd: #059669; --st-avail-txt: #ecfdf5;
      --st-unavail-bg: #7f1d1d; --st-unavail-brd: #b91c1c; --st-unavail-txt: #fef2f2;
      --st-error-bg: #78350f; --st-error-brd: #d97706; --st-error-txt: #fffbeb;
    }
    [data-theme="dim"] {
      --bg: #18181b;
      --surface: #27272a;
      --border: #3f3f46;
      --text: #f4f4f5;
      --text-muted: #a1a1aa;

      /* Dark Plate Override */
      --plate-bg: radial-gradient(120% 120% at 50% -20%, #1a1b21 0%, #0b0c10 55%, #000 100%);
      --plate-border: #2a2d3a;
      --plate-text: #fff;
      --plate-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -2px 6px rgba(0,0,0,.5), 0 0 0 3px rgba(59,130,246,.25), 0 12px 36px rgba(59,130,246,.35);
    }
    [data-theme="sepia"] {
      --bg: #fdf6e3;
      --surface: #eee8d5;
      --border: #d3cbb7;
      --text: #5f5a4e;
      --text-muted: #93a1a1;
      --accent: #b58900;

      /* Sepia Plate */
      --plate-bg: radial-gradient(120% 120% at 50% -20%, #fdf6e3 0%, #eee8d5 55%, #d3cbb7 100%);
      --plate-border: #d3cbb7;
      --plate-text: #5f5a4e;
      --plate-shadow: inset 0 1px 0 rgba(255,255,255,.5), inset 0 -2px 6px rgba(0,0,0,.1), 0 0 0 3px rgba(181,137,0,.25), 0 12px 36px rgba(181,137,0,.35);
    }
    [data-theme="nord"] {
      --bg: #2e3440;
      --surface: #3b4252;
      --border: #4c566a;
      --text: #eceff4;
      --text-muted: #d8dee9;
      --accent: #88c0d0;

      /* Dark Plate Override */
      --plate-bg: radial-gradient(120% 120% at 50% -20%, #1a1b21 0%, #0b0c10 55%, #000 100%);
      --plate-border: #2a2d3a;
      --plate-text: #fff;
      --plate-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -2px 6px rgba(0,0,0,.5), 0 0 0 3px rgba(136,192,208,.25), 0 12px 36px rgba(136,192,208,.35);
    }
    [data-theme="midnight"] {
      --bg: #020617;
      --surface: #0f172a;
      --border: #1e293b;
      --text: #e2e8f0;
      --text-muted: #64748b;
      --accent: #6366f1;

      /* Dark Plate Override */
      --plate-bg: radial-gradient(120% 120% at 50% -20%, #1a1b21 0%, #0b0c10 55%, #000 100%);
      --plate-border: #2a2d3a;
      --plate-text: #fff;
      --plate-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -2px 6px rgba(0,0,0,.5), 0 0 0 3px rgba(99,102,241,.25), 0 12px 36px rgba(99,102,241,.35);
    }
    [data-theme="forest"] {
      --bg: #1a2e1a;
      --surface: #264026;
      --border: #3a5c3a;
      --text: #e8f5e9;
      --text-muted: #a5d6a7;
      --accent: #4ade80;

      /* Dark Plate Override */
      --plate-bg: radial-gradient(120% 120% at 50% -20%, #1a1b21 0%, #0b0c10 55%, #000 100%);
      --plate-border: #2a2d3a;
      --plate-text: #fff;
      --plate-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -2px 6px rgba(0,0,0,.5), 0 0 0 3px rgba(74,222,128,.25), 0 12px 36px rgba(74,222,128,.35);
    }
    [data-theme="berry"] {
      --bg: #2e1065;
      --surface: #4c1d95;
      --border: #5b21b6;
      --text: #f3e8ff;
      --text-muted: #d8b4fe;
      --accent: #d946ef;

      /* Dark Plate Override */
      --plate-bg: radial-gradient(120% 120% at 50% -20%, #1a1b21 0%, #0b0c10 55%, #000 100%);
      --plate-border: #2a2d3a;
      --plate-text: #fff;
      --plate-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -2px 6px rgba(0,0,0,.5), 0 0 0 3px rgba(217,70,239,.25), 0 12px 36px rgba(217,70,239,.35);
    }

    /* Apply Theme Variables */
    body { 
      background-color: var(--bg); 
      color: var(--text); 
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s, color 0.3s; 
    }

    /* Apply Plate Variables */
    .header-plate { 
      width: 60px; height: 34px; 
      border-radius: 4px; 
      border: 1px solid var(--plate-border);
      position: relative; 
      display: flex; align-items: center; justify-content: center;
      background: var(--plate-bg); 
      color: var(--plate-text); 
      box-shadow: var(--plate-shadow); 
      flex-shrink: 0;
    }
    .header-plate .title .fit { color: var(--plate-text); }
    .header-plate .title { font-weight: 900; font-size: 10px; letter-spacing: 0.5px; text-transform: uppercase; }
    .header-plate .bolts { position: absolute; top: 3px; left: 4px; width: 3px; height: 3px; background: rgba(0,0,0,0.15); border-radius: 50%; box-shadow: 48px 0 0 rgba(0,0,0,0.15); }
    .header-plate .bolts.btm { top: auto; bottom: 3px; }

    /* Board Grid Layout */
    #board {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      padding: 1.5rem;
      max-width: 1600px;
      margin: 0 auto;
      transform: scale(var(--zoom));
      transform-origin: top center;
    }

    /* Dynamic Card Styling (Targeting generated elements) */
    #board > div {
      background-color: var(--surface);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1.25rem;
      box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    #board > div:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      border-color: var(--accent);
    }
    
    /* Status Coloring */
    #board > div.available { background-color: var(--st-avail-bg); border-color: var(--st-avail-brd); color: var(--st-avail-txt); }
    #board > div.unavailable { background-color: var(--st-unavail-bg); border-color: var(--st-unavail-brd); color: var(--st-unavail-txt); }
    #board > div.error { background-color: var(--st-error-bg); border-color: var(--st-error-brd); color: var(--st-error-txt); }

    /* Plate Text Visibility */
    #board > div .fit { font-size: 3rem; font-weight: 900; letter-spacing: 0.1em; text-transform: uppercase; display: block; text-align: center; padding: 0.5rem 0; }
    
    /* Ensure inputs/selects inherit text color properly */
    input::placeholder { color: var(--text-muted); opacity: 0.5; }
    
    /* Scrollbar styling for themes */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

    /* Plate Actions Footer */
    .plate-actions {
      margin-top: auto;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 0.5rem;
    }
    .plate-action-btn {
      flex: 1;
      padding: 0.5rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      display: flex; align-items: center; justify-content: center; gap: 0.25rem;
    }
    .plate-action-btn.refresh { background-color: var(--bg); color: var(--text); border-color: var(--border); }
    .plate-action-btn.refresh:hover { border-color: var(--accent); color: var(--accent); }
    .plate-action-btn.delete { background-color: transparent; color: var(--text-muted); }
    .plate-action-btn.delete:hover { background-color: #fee2e2; color: #ef4444; }
    
    /* Hide original delete overlay if present from app.js */
    .delete-overlay { display: none !important; }
  </style>
</head>
<body>
<div class="wrap flex flex-col min-h-screen">
  <header class="sticky top-0 z-50">
    <div class="bar bg-[var(--surface)] border-b border-[var(--border)] shadow-sm backdrop-blur-xl bg-opacity-90 transition-colors duration-300">
      
      <!-- Top Bar: Logo & Main Controls -->
      <div class="px-4 py-3 flex flex-col md:flex-row items-center justify-between gap-4">
        
        <!-- Logo Section -->
        <div class="header-stack flex items-center gap-4 self-start md:self-auto">
        <div class="header-plate" title="PLATES">
          <div class="bolts"></div>
          <div class="bolts btm"></div>
          <div class="title"><span id="titleFit" class="fit">PLATES</span></div>
        </div>
          <div class="flex flex-col">
            <div class="font-bold text-lg leading-tight tracking-tight">Plate Lookup & Availability Tracking Eligibility System</div>
            <div class="under-info text-xs text-[var(--text-muted)] flex gap-2">
              <span class="site font-medium">carsandcollectibles.com</span>
              <span class="opacity-50">•</span>
              <span class="date" id="hdrDate"></span>
            </div>
          </div>
        </div>

        <!-- Primary Controls -->
        <div class="controls flex flex-wrap items-center justify-center gap-2 w-full md:w-auto">
          <input id="q" type="search" placeholder="Search plates..." aria-label="Search plates" spellcheck="false"
            class="px-3 py-2 rounded-lg bg-[var(--bg)] border border-[var(--border)] text-sm focus:outline-none focus:ring-2 focus:ring-[var(--accent)] w-full md:w-48 transition-all shadow-sm"/>
          
          <select id="status" aria-label="Filter by status" class="px-3 py-2 rounded-lg bg-[var(--bg)] border border-[var(--border)] text-sm focus:outline-none focus:ring-2 focus:ring-[var(--accent)] shadow-sm cursor-pointer">
            <option value="">All Status</option>
            <option value="Available">Available</option>
            <option value="Unavailable">Unavailable</option>
            <option value="Error">Error</option>
            <option value="Unknown">Unknown</option>
          </select>

          <select id="stateFilter" title="State" aria-label="Filter by state" class="px-3 py-2 rounded-lg bg-[var(--bg)] border border-[var(--border)] text-sm focus:outline-none focus:ring-2 focus:ring-[var(--accent)] shadow-sm cursor-pointer">
            <option value="">All States</option>
            <option value="ID">Idaho (ID)</option>
            <option value="CA">California (CA)</option>
          </select>

          <button id="refresh" class="btn px-4 py-2 rounded-lg bg-[var(--accent)] text-white font-medium hover:opacity-90 transition-opacity shadow-sm flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
            Refresh
          </button>
        </div>

        <!-- Secondary Controls / Settings -->
        <div class="controls flex items-center gap-2 text-sm">
          <button id="addPlateBtn" class="px-4 py-2 rounded-lg bg-[var(--accent)] text-white font-bold shadow-md hover:opacity-90 transition-all flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
            Add Plate
          </button>
          
          <div class="relative group">
            <button class="px-3 py-2 rounded-lg border border-[var(--border)] hover:bg-[var(--bg)] transition-colors text-[var(--text)]">Menu ▼</button>
            <div class="absolute right-0 mt-2 w-48 bg-[var(--surface)] border border-[var(--border)] rounded-xl shadow-xl p-2 hidden group-hover:block group-focus-within:block z-50">
              <button id="exportBtn" class="w-full text-left px-3 py-2 rounded-lg hover:bg-[var(--bg)] text-[var(--text)]">Export JSON</button>
              <label for="importFile" class="block w-full text-left px-3 py-2 rounded-lg hover:bg-[var(--bg)] text-[var(--text)] cursor-pointer">Import JSON</label>
              <input id="importFile" type="file" accept="application/json" style="display:none"/>
              <div class="h-px bg-[var(--border)] my-1"></div>
              <div class="px-3 py-1 text-xs text-[var(--text-muted)] font-bold uppercase">Theme</div>
              <select id="themeSelect" class="w-full mt-1 px-2 py-1 rounded bg-[var(--bg)] border border-[var(--border)] text-xs">
                <option value="">Light</option>
                <option value="dark">Dark</option>
                <option value="dim">Dim</option>
                <option value="sepia">Sepia</option>
                <option value="nord">Nord</option>
                <option value="midnight">Midnight</option>
                <option value="forest">Forest</option>
                <option value="berry">Berry</option>
              </select>
              <div class="mt-2 px-3 py-1 text-xs text-[var(--text-muted)] font-bold uppercase">Zoom</div>
              <input id="zoom" type="range" min="40" max="180" value="100" class="w-full accent-[var(--accent)]">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Status Bar -->
      <div class="px-4 py-1 bg-[var(--bg)] border-b border-[var(--border)] text-xs flex justify-between items-center text-[var(--text-muted)]">
        <span id="runStatus" class="font-mono" role="status">Ready</span>
        <span id="updated" role="status">Last updated: —</span>
      </div>
    </div>
  </header>

  <main class="flex-1 bg-[var(--bg)] flex flex-col xl:flex-row">
    <div class="flex-1 min-w-0">
      <div id="board" class="w-full"></div>
    </div>
    
    <!-- Sidebar: SEO Content & AdSense -->
    <aside class="w-full xl:w-96 flex-shrink-0 border-t xl:border-t-0 xl:border-l border-[var(--border)] bg-[var(--surface)] p-6">
      <h1 class="text-xl font-bold mb-4 text-[var(--text)]">Vanity Plate Tracker</h1>
      <div class="prose dark:prose-invert max-w-none text-[var(--text-muted)] text-sm space-y-4 leading-relaxed">
        <p>
          Finding the perfect <strong>vanity license plate</strong> (also known as a personalized plate) can be difficult. DMVs often have slow search tools, and popular combinations like "FAST", "COOL", or specific names are frequently taken.
        </p>
        
        <!-- Sidebar Ad -->
        <div class="my-6 flex justify-center overflow-hidden bg-[var(--bg)] p-2 rounded-xl border border-[var(--border)]">
           <ins class="adsbygoogle"
             style="display:block; width: 100%; min-width: 300px;"
             data-ad-client="ca-pub-5978349780180432"
             data-ad-slot="3728400476"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
           <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <p>
          The <strong>PLATES</strong> tool allows you to:
        </p>
        <ul class="list-disc pl-5 space-y-1">
          <li>Instantly check availability for personalized plates in supported states.</li>
          <li>Track specific plate combinations over time.</li>
          <li>Visualize how the text looks on a simulated license plate.</li>
        </ul>

        <h2 class="text-lg font-semibold mt-6 mb-2 text-[var(--text)]">Tips for Personalized Plates</h2>
        <p>
          If your first choice is taken, try using numbers in place of letters (e.g., "E" to "3", "A" to "4", "S" to "5"). You can also try phonetic spellings. Remember that DMVs reject plates that are considered offensive or misleading.
        </p>
      </div>
    </aside>
  </main>

</div>

<!-- Add Plate Modal -->
<div id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" class="fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 hidden">
  <div class="box bg-[var(--surface)] border border-[var(--border)] rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
    <h3 id="modalTitle" class="text-xl font-bold mb-4 text-[var(--text)]">Add a Plate</h3>
    
    <div class="space-y-4">
      <div>
        <label class="block text-xs font-bold text-[var(--text-muted)] uppercase mb-1">Plate Text</label>
        <input id="m_plateText" placeholder="e.g. B00ST" aria-label="Plate text" autocapitalize="characters" autocomplete="off" spellcheck="false"
          class="w-full px-4 py-3 rounded-xl bg-[var(--bg)] border border-[var(--border)] text-lg font-mono uppercase focus:outline-none focus:ring-2 focus:ring-[var(--accent)]"/>
      </div>
      
      <div>
        <label class="block text-xs font-bold text-[var(--text-muted)] uppercase mb-1">State</label>
        <select id="m_state" title="State" aria-label="Select state"
          class="w-full px-4 py-3 rounded-xl bg-[var(--bg)] border border-[var(--border)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)]">
        <option value="ID" selected>Idaho</option>
        <option value="CA">California</option>
      </select>
    </div>

    <div class="text-xs text-[var(--text-muted)] bg-[var(--bg)] p-3 rounded-lg border border-[var(--border)]">
      Vehicle: PassengerVehicle • Kind: Personalized
    </div>

    <div class="flex items-center justify-end gap-3 mt-6">
      <span id="m_msg" class="text-red-500 text-sm mr-auto"></span>
      <button id="m_cancel" class="px-4 py-2 rounded-lg text-[var(--text-muted)] hover:bg-[var(--bg)] transition-colors">Cancel</button>
      <button id="m_submit" class="px-6 py-2 rounded-lg bg-[var(--accent)] text-white font-bold shadow-lg shadow-[var(--accent)]/30 hover:opacity-90 transition-all">Add Plate</button>
    </div>
    </div>
  </div>
</div>

<!-- Refresh confirmation modal -->
<div id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" class="fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 hidden">
  <div class="box bg-[var(--surface)] border border-[var(--border)] rounded-2xl shadow-2xl w-full max-w-md p-6">
    <h3 id="confirmTitle" class="text-xl font-bold mb-2 text-[var(--text)]">Refresh checks?</h3>
    <p class="text-sm text-[var(--text-muted)] mb-6">To protect the DMV endpoint, choose carefully. “Check due only” is safe and recommended.</p>
    <div class="flex justify-end gap-3">
      <button id="cfm_cancel" class="px-4 py-2 rounded-lg text-[var(--text-muted)] hover:bg-[var(--bg)]">Cancel</button>
      <button id="cfm_due" class="px-4 py-2 rounded-lg border border-[var(--border)] text-[var(--text)] hover:bg-[var(--bg)]">Check due only</button>
      <button id="cfm_force" class="px-4 py-2 rounded-lg bg-red-500 text-white font-bold hover:bg-red-600">Force recheck all</button>
    </div>
  </div>
</div>

<!-- Delete confirmation modal -->
<div id="deleteModal" role="dialog" aria-modal="true" aria-labelledby="deleteTitle" class="fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 hidden">
  <div class="box bg-[var(--surface)] border border-[var(--border)] rounded-2xl shadow-2xl w-full max-w-sm p-6">
    <h3 id="deleteTitle" class="text-xl font-bold mb-2 text-[var(--text)]">Delete plate?</h3>
    <p class="text-sm text-[var(--text-muted)] mb-6">
      You are about to remove <strong id="delLabel"></strong> from this dashboard. You can re-add it later.
    </p>
    <div class="flex justify-end gap-3">
      <button id="del_cancel" class="px-4 py-2 rounded-lg text-[var(--text-muted)] hover:bg-[var(--bg)]">Cancel</button>
      <button id="del_confirm" class="px-4 py-2 rounded-lg bg-red-500 text-white font-bold hover:bg-red-600">Delete</button>
    </div>
  </div>
</div>

<script defer src="app.js"></script>
<script>
  // Theme Logic
  (function() {
    const sel = document.getElementById('themeSelect');
    const stored = localStorage.getItem('vm_theme') || '';
    
    // Apply initial
    if (stored) {
      document.documentElement.setAttribute('data-theme', stored);
      if (sel) sel.value = stored;
    }

    // Listener
    sel.addEventListener('change', e => {
      const val = e.target.value;
      if (val) document.documentElement.setAttribute('data-theme', val);
      else document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('vm_theme', val);
    });

    // Zoom Logic
    const zoom = document.getElementById('zoom');
    if (zoom) {
      zoom.addEventListener('input', e => document.documentElement.style.setProperty('--zoom', e.target.value / 100));
    }
  })();

  // Inject Refresh Buttons & Enhance UI
  const board = document.getElementById('board');
  if (board) {
    const observer = new MutationObserver(mutations => {
      mutations.forEach(m => {
        m.addedNodes.forEach(node => {
          if (node.nodeType === 1) {
            if (node.querySelector('.plate-actions')) return;

            // Check if this is a real plate (has .fit class)
            if (!node.querySelector('.fit')) {
               // Likely the "No plates" empty state
               const addBtn = document.createElement('button');
               addBtn.className = 'mt-4 px-6 py-2 rounded-lg bg-[var(--accent)] text-white font-bold shadow-lg hover:opacity-90 transition-all';
               addBtn.innerText = 'Add a Plate';
               addBtn.onclick = () => document.getElementById('addPlateBtn').click();
               
               node.style.display = 'flex';
               node.style.flexDirection = 'column';
               node.style.alignItems = 'center';
               node.style.justifyContent = 'center';
               node.appendChild(addBtn);
               return;
            }

            // Find original delete button to proxy if it exists
            const originalDel = node.querySelector('.delete-button');

            const actions = document.createElement('div');
            actions.className = 'plate-actions';

            // Refresh Button
            const refreshBtn = document.createElement('button');
            refreshBtn.className = 'plate-action-btn refresh';
            refreshBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg> Refresh Plate';
            refreshBtn.onclick = async (e) => {
              e.stopPropagation();
              
              // Visual Feedback
              const originalText = refreshBtn.innerHTML;
              refreshBtn.innerHTML = '<svg class="animate-spin h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Checking...';
              refreshBtn.disabled = true;
              refreshBtn.style.opacity = '0.7';

              const text = node.querySelector('.fit')?.innerText;
              const state = node.querySelector('.state')?.innerText;
              const timeEl = node.querySelector('.ago');
              
              if (typeof checkPlate === 'function' && text) {
                try {
                  await checkPlate(text, state);
                  if (timeEl) {
                    timeEl.innerText = 'Just now';
                    timeEl.style.opacity = '1';
                  }
                } catch (err) {
                  console.error(err);
                }
              }
              
              setTimeout(() => {
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
                refreshBtn.style.opacity = '1';
              }, 500);
            };

            // Delete Button (Proxy)
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'plate-action-btn delete';
            deleteBtn.innerText = 'Delete Plate';
            deleteBtn.onclick = (e) => { e.stopPropagation(); if(originalDel) originalDel.click(); };

            actions.appendChild(refreshBtn);
            actions.appendChild(deleteBtn);
            node.appendChild(actions);
          }
        });
      });
    });
    observer.observe(board, { childList: true });
  }
</script>
</body>
</html>
