<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Plate Lookup &amp; Availability Tracking Eligibility System</title>
  <meta name="description" content="Dashboard to track vanity license plate availability across states.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Themes */
    :root {
      /* Default (Light) */
      --bg: #f8fafc;
      --surface: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --text-muted: #64748b;
      --accent: #10b981;
    }
    [data-theme="dark"] {
      --bg: #0f172a;
      --surface: #1e293b;
      --border: #334155;
      --text: #f8fafc;
      --text-muted: #94a3b8;
    }
    [data-theme="dim"] {
      --bg: #18181b;
      --surface: #27272a;
      --border: #3f3f46;
      --text: #f4f4f5;
      --text-muted: #a1a1aa;
    }
    [data-theme="sepia"] {
      --bg: #fdf6e3;
      --surface: #eee8d5;
      --border: #d3cbb7;
      --text: #5f5a4e;
      --text-muted: #93a1a1;
      --accent: #b58900;
    }
    [data-theme="nord"] {
      --bg: #2e3440;
      --surface: #3b4252;
      --border: #4c566a;
      --text: #eceff4;
      --text-muted: #d8dee9;
      --accent: #88c0d0;
    }
    [data-theme="midnight"] {
      --bg: #020617;
      --surface: #0f172a;
      --border: #1e293b;
      --text: #e2e8f0;
      --text-muted: #64748b;
      --accent: #6366f1;
    }
    [data-theme="forest"] {
      --bg: #1a2e1a;
      --surface: #264026;
      --border: #3a5c3a;
      --text: #e8f5e9;
      --text-muted: #a5d6a7;
      --accent: #4ade80;
    }
    [data-theme="berry"] {
      --bg: #2e1065;
      --surface: #4c1d95;
      --border: #5b21b6;
      --text: #f3e8ff;
      --text-muted: #d8b4fe;
      --accent: #d946ef;
    }

    /* Apply Theme Variables */
    body { background-color: var(--bg); color: var(--text); transition: background-color 0.3s, color 0.3s; }
    .bar { background-color: var(--surface); border-bottom-color: var(--border); }
    .box { background-color: var(--surface); border-color: var(--border); color: var(--text); }
    input, select, .pill { background-color: var(--surface); border-color: var(--border); color: var(--text); }
    .btn.ghost { color: var(--text); }
    .under-name, .under-info { color: var(--text-muted); }
    
    /* Ensure inputs/selects inherit text color properly */
    input::placeholder { color: var(--text-muted); opacity: 0.7; }
    
    /* Scrollbar styling for themes */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
  </style>
</head>
<body>
<div class="wrap" style="display:flex;flex-direction:column;min-height:100%">
  <header>
    <div class="bar">
      <div class="header-stack">
        <div class="header-plate" title="PLATES">
          <div class="face"></div>
          <div class="bolts"></div>
          <div class="bolts btm"></div>
          <div class="title"><span id="titleFit" class="fit">PLATES</span></div>
        </div>
        <div class="under-name">Plate Lookup &amp; Availability Tracking Eligibility System</div>
        <div class="under-info">
          <span class="site">carsandcollectibles.com</span>
          <span class="date" id="hdrDate"></span>
        </div>
      </div>

      <div class="controls">
        <input id="q" type="search" placeholder="Search…" aria-label="Search plates" spellcheck="false"/>
        <select id="status" aria-label="Filter by status">
          <option value="">All</option>
          <option value="Available">Available</option>
          <option value="Unavailable">Unavailable</option>
          <option value="Error">Error</option>
          <option value="Unknown">Unknown</option>
        </select>

        <!-- NEW: State filter -->
        <select id="stateFilter" title="State" aria-label="Filter by state">
          <option value="">All States</option>
          <option value="ID">Idaho (ID)</option>
          <option value="CA">California (CA)</option>
        </select>

        <button id="refresh" class="btn">Refresh</button>
        <span id="runStatus" class="pill" style="display:none" role="status"></span>

        <button id="addPlateBtn" class="btn secondary">Add Plate</button>
        <button id="exportBtn" class="btn ghost">Export</button>
        <label class="btn ghost" for="importFile" style="display:inline-block">Import</label>
        <input id="importFile" type="file" accept="application/json" style="display:none"/>
      </div>

      <div class="spacer"></div>

      <div class="controls" style="margin-left:auto">
        <select id="themeSelect" aria-label="Select Theme" title="Theme">
          <option value="">Light</option>
          <option value="dark">Dark</option>
          <option value="dim">Dim</option>
          <option value="sepia">Sepia</option>
          <option value="nord">Nord</option>
          <option value="midnight">Midnight</option>
          <option value="forest">Forest</option>
          <option value="berry">Berry</option>
        </select>
        <label class="pill">Zoom
          <input id="zoom" type="range" min="40" max="180" value="100" style="vertical-align:middle;margin-left:6px">
        </label>
        <span id="updated" class="pill" role="status">—</span>
      </div>
    </div>
  </header>

  <main class="board-wrap">
    <div id="board" class="board"></div>
  </main>
</div>

<!-- Add Plate Modal -->
<div id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="box">
    <h3 id="modalTitle" style="margin:0 0 10px">Add a Plate</h3>
    <div class="controls" style="margin:0 0 12px">
      <input id="m_plateText" placeholder="Plate text (e.g., B00ST)" aria-label="Plate text" autocapitalize="characters" autocomplete="off" spellcheck="false"/>
      <select id="m_state" title="State" aria-label="Select state">
        <option value="ID" selected>Idaho</option>
        <option value="CA">California</option>
      </select>
    </div>
    <div class="controls small" style="margin:0 0 8px">
      <span>Vehicle: PassengerVehicle • Kind: Personalized</span>
    </div>
    <div class="controls">
      <span id="m_msg" class="muted small" style="flex:1"></span>
      <button id="m_cancel" class="pill">Cancel</button>
      <button id="m_submit" class="btn">Add</button>
    </div>
  </div>
</div>

<!-- Refresh confirmation modal -->
<div id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
  <div class="box">
    <h3 id="confirmTitle" style="margin:0 0 8px">Refresh checks?</h3>
    <p class="small" style="margin-top:0">To protect the DMV endpoint, choose carefully. “Check due only” is safe and recommended.</p>
    <div class="controls" style="justify-content:flex-end">
      <button id="cfm_cancel" class="pill">Cancel</button>
      <button id="cfm_due" class="btn ghost">Check due only</button>
      <button id="cfm_force" class="btn" style="background:#ef4444">Force recheck all</button>
    </div>
  </div>
</div>

<!-- Delete confirmation modal -->
<div id="deleteModal" role="dialog" aria-modal="true" aria-labelledby="deleteTitle">
  <div class="box">
    <h3 id="deleteTitle" style="margin:0 0 8px">Delete plate?</h3>
    <p class="small" style="margin-top:0">
      You are about to remove <strong id="delLabel"></strong> from this dashboard. You can re-add it later.
    </p>
    <div class="controls" style="justify-content:flex-end">
      <button id="del_cancel" class="pill">Cancel</button>
      <button id="del_confirm" class="btn" style="background:#ef4444">Delete</button>
    </div>
  </div>
</div>

<script defer src="app.js"></script>
<script>
  // Theme Logic
  (function() {
    const sel = document.getElementById('themeSelect');
    const stored = localStorage.getItem('vm_theme') || '';
    
    // Apply initial
    if (stored) {
      document.documentElement.setAttribute('data-theme', stored);
      if (sel) sel.value = stored;
    }

    // Listener
    sel.addEventListener('change', e => {
      const val = e.target.value;
      if (val) document.documentElement.setAttribute('data-theme', val);
      else document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('vm_theme', val);
    });
  })();
</script>
</body>
</html>
